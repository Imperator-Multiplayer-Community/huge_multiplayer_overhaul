types economy_types {
	type policy_button = container {
		tooltip = "[EconomicPolicyGlue.GetTooltip]"

		button_radial = {
			layoutpolicy_horizontal = expanding
			block "transparency" {}
			blockoverride "On_click"
			{
				#onclick = "[ClickHighlight(EconomicPolicyGlue.GetHighlightKey)]" #TODO Red King stuff?
				onclick = "[EconomicPolicyGlue.OnClick]"
			}

			blockoverride "ShowDot"
			{
				trigger_when = "[EconomicPolicyGlue.IsSelected]"
			}

			blockoverride "HideDot"
			{
				trigger_when = "[Not(EconomicPolicyGlue.IsSelected)]"
			}
		}
	}
}

base_window = {
	gfxtype = windowgfx
	name = "economy_view"
	parentanchor = top|left
	size = { 640 900 }
	widgetanchor = top|left
	using = main_window_template
	using = FadeStates

	using = movable_windows

	state = {
		name = reset_economy
		using = default_position
		trigger_when = "[Not(ScriptedGui.IsShown(GuiScope.SetRoot(Player.MakeScope).End))]"
	}

	using = advice_trigger_highlights

	### Audio ###
	state = {
		name = _show
		start_sound = {
			soundeffect = "event:/SFX/UI/Generic/2.0/sfx_ui_window_tab_close"
		}
	}
	state = {
		name = _hide
		start_sound = {
			soundeffect = "event:/SFX/UI/Generic/2.0/sfx_ui_window_tab_close"
		}
	}

	icon = {
		texture = "gfx/interface/event_window/Event_open_chest.dds"
		scale = 0.4
		alpha = 0.85
		parentanchor = top|right
		position = { 0 70 }
	}

	vbox = {
		using = MainWindowHeaderBox

		blockoverride "FlagOrIcon"
		{
			icon = {
				texture = "gfx/interface/base_parts/yellow_button_color_200fs.dds"
				framesize = { 100 100 }
				frame = 6
				position = { -2 -2 }
				size = { 32 32 }
				modify_texture = {
					texture = "gfx/interface/icons/menu_buttons/menu_economy.dds"
					blend_mode = alphamultiply
				}
			}
		}

		blockoverride "Title_text"
		{
			text = "ECONOMY_MENU_HEADER"
		}

		blockoverride "White_buttons"
		{
			button_back = {
				shortcut = "previous_window"
				onclick = "[EconomyView.OnPrevious]"
				tooltip = "PREVIOUS_ECONOMY_VIEW"
			}

			button_reset = {
				blockoverride "On_click" {
					onclick = "[PdxGuiTriggerAllAnimations('reset_economy')]"
				}
			}

			button_close = {
				onclick = "[EconomyView.OnClose]"
				tooltip = "CLOSE"
				shortcut = "close_window"
			}
		}

		vbox = {
			layoutpolicy_vertical = expanding
			layoutpolicy_horizontal = expanding

			margin_widget = {
				name = "Balance"
				minimumsize = { 0 198 }
				margin_top = 20
				margin_left = 28
				layoutpolicy_horizontal = expanding

				flowcontainer = {
					direction = vertical
					spacing = 6

					icon_and_text = {
						tooltip = "BALANCE_TOOLTIP"
						size = { 182 0 }
						blockoverride "Icon" { texture = "gfx/interface/icons/shared_icons/treasury.dds" }
						blockoverride "Text" { text = "[EconomyView.GetBalance]" }
					}

					flowcontainer = {
						ignoreinvisible = yes
						visible = "[EconomyView.HasDeficit]"
						tooltip = "[EconomyView.GetDeficitTooltip]"
						spacing = 6
						icon_and_text = {
							tooltip = "BALANCE_TOOLTIP"
							size = { 182 0 }
							blockoverride "Icon" { using = icon_bankruptcy }
							blockoverride "Text" { text = "IN_DEFICIT" }
						}
					}
					flowcontainer = {
						visible = "[Not(EconomyView.HasDeficit)]"
						tooltip = "[EconomyView.GetNoDeficitTooltip]"
						spacing = 6

						icon_and_text = {
							tooltip = "BALANCE_TOOLTIP"
							size = { 182 0 }
							blockoverride "Icon" { visible = no }
							blockoverride "Text" { text = "NO_DEFICIT_TEXT" }
						}
					}
				}
			}
			vbox = {
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding
				container = {
					container = {

						container = {
							name = "income header"
							position = { 5 0 }
							using = NoninteractableBG
							sub_header = {
								size = { 206 0 }
								position = { -8 -2 }
								blockoverride "Title_text" { text = "INCOMES_HEADER" }
							}
							textbox = {
								position = { 1 -2 }
								parentanchor = top|right
								autoresize = yes
								text = "#g +#![EconomyView.GetTotalIncome|+2]@gold!"
								using = BaseFontM
							}
							widget = {
								position = { 273 0 }
							}
						}


						dynamicgridbox = {
							name = "income_grid"
							position = { 0 47 }
							size = { 180 200 }
							datamodel = "[EconomyView.GetIncome]"
							item = {
								flowcontainer = {
									direction = vertical
									container = {
										ignoreinvisible = yes
										alpha = "[TransparentIfTrue( And( EqualTo_int32( EconomyView.GetPlayer.GetNumOfSubjects, '(int32)0' ), IncomeItem.IsTribute ) )]"
										using = NoninteractableBG

										blockoverride "Margins"
										{
											margin = { 4 4 }
											margin_bottom = 0
											margin_top = 6
										}

										container = {
											tooltip = "[IncomeItem.GetTooltip]"

											textbox = {
												position = { 12 2 }
												autoresize = yes
												using = BaseFontS
												using = Black_FontColor
												text = "[IncomeItem.GetName]"
											}

											icon_and_text = {
												position = { 152 -2 }
												size = { 132 0 }
												blockoverride "Text" { text = "[IncomeItem.GetValue|2]" }
												blockoverride "Icon" { texture = "gfx/interface/icons/shared_icons/treasury.dds" }
											}
										}

										icon_and_text = {
											position = { 152 34 }
											size = { 132 0 }
											blockoverride "Text" { text = "[IncomeItem.GetModifierValue]" }
											blockoverride "Icon" { texture = "[IncomeItem.GetModifierIcon]" }
											tooltip = "[IncomeItem.GetModifierTooltip]"
										}

										dynamicgridbox = {
											position = { 12 40 }
											datamodel = "[IncomeItem.GetPolicies]"
											flipdirection = yes
											item = {
												widget = {
													size = { 40 40 }
													policy_button = {
														enabled = "[And(EconomicPolicyGlue.CanClick, Not(And(EqualTo_int32( EconomyView.GetPlayer.GetNumOfSubjects, '(int32)0' ), IncomeItem.IsTribute)))]"
														blockoverride "transparency" {
															alpha = "[TransparentIfTrue( And( EqualTo_int32( EconomyView.GetPlayer.GetNumOfSubjects, '(int32)0' ), IncomeItem.IsTribute ) )]"
														}
													}
												}
											}
										}
									}
									widget = { size = { 4 12 } } # Item Spacing
								}
							}
						}
					}
					container = {
						position = { 307 0 }

						container = {
							name = "expenses header"
							position = { 5 0 }
							using = NoninteractableBG
							sub_header = {
								size = { 206 0 }
								position = { -8 -2 }
								blockoverride "Title_text" { text = "EXPENSES_HEADER" }
							}
							textbox = {
								position = { 1 -2 }
								parentanchor = top|right
								autoresize = yes
								text = "#r -#![EconomyView.GetTotalExpense|-2]@gold!"
								using = BaseFontM
							}
							widget = {
								position = { 273 0 }
							}
						}

						dynamicgridbox = {
							name = "expense_grid"
							position = { 0 47 }
							size = { 180 200 }
							datamodel = "[EconomyView.GetExpense]"
							item = {
								flowcontainer = {
									direction = vertical
									container = {
										ignoreinvisible = yes
										alpha = "[TransparentIfTrue(Not(ExpenseItem.IsEnabled))]"
										using = NoninteractableBG

										blockoverride "Margins"
										{
											margin = { 4 4 }
											margin_bottom = 0
											margin_top = 6
										}

										container = {
											tooltip = "[ExpenseItem.GetTooltip]"

											textbox = {
												position = { 12 2 }
												autoresize = yes
												using = BaseFontS
												using = Black_FontColor
												text = "[ExpenseItem.GetName]"
											}

											icon_and_text = {
												position = { 152 -4 }
												size = { 132 0 }
												blockoverride "Text" { text = "[ExpenseItem.GetValue|2]" }
												blockoverride "Icon" { texture = "gfx/interface/icons/shared_icons/treasury.dds" }
											}
										}

										icon_and_text = {
											position = { 152 34 }
											size = { 132 0 }
											visible = "[ExpenseItem.HasModifier]"
											blockoverride "Text" { text = "[ExpenseItem.GetModifierValue]" }
											blockoverride "Icon" { texture = "[ExpenseItem.GetModifierIcon]" }
											tooltip = "[ExpenseItem.GetModifierTooltip]"
										}

										dynamicgridbox = {
											position = { 12 40 }
											datamodel = "[ExpenseItem.GetPolicies]"
											flipdirection = yes
											item = {
												widget = {
													size = { 40 40 }
													policy_button = {
														enabled = "[And(EconomicPolicyGlue.CanClick, ExpenseItem.IsEnabled)]"
														blockoverride "transparency" {
															alpha = "[TransparentIfTrue(Not(ExpenseItem.IsEnabled))]"
														}
													}
												}
											}
										}
									}
									widget = { size = { 4 12 } } # Item Spacing
								}
							}
						}
					}
				}
				vbox = {
					layoutpolicy_vertical = expanding
				}
			}
		}
	}

	# LOOTING POLICY
	vbox = {
		name = "Looting Policy"
		layoutpolicy_horizontal = expanding
		layoutpolicy_vertical = expanding
		margin = { 0 0 }

		margin_widget = {
			layoutpolicy_horizontal = expanding
			size = { 0 400 }
			# using = NoninteractableBG

			flowcontainer = {
				position = { 30 340 }
				margin_left = 10
				margin_right = 145
				using = NoninteractableBG
				parentanchor = left
				direction = vertical

				container = {
					textbox = {
						position = { 0 0 }
						autoresize = yes
						using = BaseFontS
						using = Black_FontColor
						text = "looting_policy"
					}
				}

				widget = { size = { 4 12 } }

				flowcontainer = {
					parentanchor = left
					direction = horizontal
					spacing = 3

					widget = {
						size = { 40 40 }
						datacontext = "[GetScriptedGui('low_looting_policy_button')]"

						button_radial = {
							tooltip = "low_looting_policy_tt"

							blockoverride "On_click"
							{
								onclick = "[ScriptedGui.Execute( GuiScope.SetRoot( Player.MakeScope ).End )]"
							}
							blockoverride "ShowDot"
							{
								trigger_when = "[ScriptedGui.IsShown( GuiScope.SetRoot( Player.MakeScope ).End )]"
							}
							blockoverride "HideDot"
							{
								trigger_when = "[Not(ScriptedGui.IsShown( GuiScope.SetRoot( Player.MakeScope ).End ))]"
							}
						}
					}
					widget = {
						size = { 40 40 }
						datacontext = "[GetScriptedGui('default_looting_policy_button')]"

						button_radial = {
							tooltip = "default_looting_policy_tt"

							blockoverride "On_click"
							{
								onclick = "[ScriptedGui.Execute( GuiScope.SetRoot( Player.MakeScope ).End )]"
							}
							blockoverride "ShowDot"
							{
								trigger_when = "[ScriptedGui.IsShown( GuiScope.SetRoot( Player.MakeScope ).End )]"
							}
							blockoverride "HideDot"
							{
								trigger_when = "[Not(ScriptedGui.IsShown( GuiScope.SetRoot( Player.MakeScope ).End ))]"
							}
						}
					}
					widget = {
						size = { 40 40 }
						datacontext = "[GetScriptedGui('high_looting_policy_button')]"

						button_radial = {
							tooltip = "high_looting_policy_tt"

							blockoverride "On_click"
							{
								onclick = "[ScriptedGui.Execute( GuiScope.SetRoot( Player.MakeScope ).End )]"
							}
							blockoverride "ShowDot"
							{
								trigger_when = "[ScriptedGui.IsShown( GuiScope.SetRoot( Player.MakeScope ).End )]"
							}
							blockoverride "HideDot"
							{
								trigger_when = "[Not(ScriptedGui.IsShown( GuiScope.SetRoot( Player.MakeScope ).End ))]"
							}
						}
					}
				}
			}
		}
	}
}
