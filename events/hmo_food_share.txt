namespace = food_share

food_share.1 = {
	type = province_event
	hidden = yes

	trigger = {
		AND = {
			exists = owner
			owner = {
				war = yes
			}
		}
		any_unit_in_province = {
			unit_owner = { # ai units wont take your food
				is_ai = no
				OR = {
					alliance_with = root
					is_subject_of = root
				}
			}
			food_percentage < 100
			in_combat = no
		}
		state = {
			has_state_food >= 10
		}
	}
	immediate = {
		every_unit_in_province = {
			limit = {
				OR = {
					unit_owner = {
						alliance_with = root
						is_subject_of = root
					}
				}
				NOT = { # ai units wont take your food
					unit_owner = {
						is_ai = no
					}
				}
				food_percentage < 100
				in_combat = no
			}

			set_local_variable = {
				name = food
				value = unit_size
			}

			change_local_variable = {
				name = food
				divide = 4
				add = 5
			}

			round_local_variable = {
				name = food
				nearest = 1
			}

			if = {
				limit = {
					unit_location = {
						state = {
							has_state_food >= local_var:food
						}
					}
				}
				
				add_food = local_var:food
				
				change_local_variable = {
					name = food
					multiply = -1
				}
				root.state = {
					add_state_food = local_var:food
				}
			}
		}
	}
}